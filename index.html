<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Cities & Landmarks Interactive Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1;
        }

        #side-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 380px;
            max-height: calc(100vh - 40px);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
        }

        .panel-header h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .panel-header p {
            font-size: 13px;
            opacity: 0.9;
        }

        .controls {
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .layer-toggles {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .layer-toggle {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .layer-toggle.active {
            background: #667eea;
            color: white;
        }

        .layer-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .search-box {
            width: 100%;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 13px;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
        }

        .table-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        thead {
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        th {
            padding: 10px 8px;
            text-align: left;
            background: #f8f9fa;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: #e9ecef;
        }

        th.sortable::after {
            content: ' ‚áÖ';
            opacity: 0.3;
        }

        th.sort-asc::after {
            content: ' ‚Üë';
            opacity: 1;
            color: #667eea;
        }

        th.sort-desc::after {
            content: ' ‚Üì';
            opacity: 1;
            color: #667eea;
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid #f0f0f0;
        }

        tr:hover {
            background: #f8f9fa;
            cursor: pointer;
        }

        tr.hidden {
            display: none;
        }

        .stats {
            padding: 10px 15px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            font-size: 12px;
            color: #6c757d;
        }

        /* Custom marker styles */
        .city-marker {
            background: #667eea;
            border: 2px solid white;
            border-radius: 50%;
            width: 12px;
            height: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .landmark-marker {
            background: #f093fb;
            border: 2px solid white;
            border-radius: 50%;
            width: 10px;
            height: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            #side-panel {
                display: none;
            }
        }

        /* Custom popup styling */
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }

        .popup-content {
            min-width: 200px;
        }

        .popup-content h3 {
            margin: 0 0 10px 0;
            color: #667eea;
        }

        .popup-content p {
            margin: 5px 0;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div id="side-panel">
        <div class="panel-header">
            <h1>üåç World Cities & Landmarks</h1>
            <p>Interactive map featuring major cities and famous landmarks</p>
        </div>
        
        <div class="controls">
            <div class="layer-toggles">
                <button class="layer-toggle active" id="toggle-cities">Cities</button>
                <button class="layer-toggle active" id="toggle-landmarks">Landmarks</button>
            </div>
            <input type="text" class="search-box" id="search-input" placeholder="Search locations...">
        </div>
        
        <div class="table-container">
            <table id="data-table">
                <thead>
                    <tr>
                        <th class="sortable" data-column="name">Name</th>
                        <th class="sortable" data-column="country">Country</th>
                        <th class="sortable" data-column="value">Value</th>
                        <th class="sortable" data-column="type">Type</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                </tbody>
            </table>
        </div>
        
        <div class="stats" id="stats">
            <span id="stats-text">Loading data...</span>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Initialize map with CartoDB Voyager style
        const map = L.map('map', {
            center: [20, 0],
            zoom: 2,
            zoomControl: true
        });

        // Add CartoDB Voyager basemap (different from standard OSM)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        // Layer groups
        let citiesLayer = L.layerGroup().addTo(map);
        let landmarksLayer = L.layerGroup().addTo(map);
        
        // Data storage
        let allData = [];
        let citiesData = [];
        let landmarksData = [];
        
        // Sorting state
        let currentSort = { column: null, direction: 'asc' };

        // Load and display cities
        fetch('assets/world-cities.geojson')
            .then(response => response.json())
            .then(data => {
                citiesData = data.features;
                
                data.features.forEach(feature => {
                    const coords = feature.geometry.coordinates;
                    const props = feature.properties;
                    
                    // Create custom marker
                    const marker = L.circleMarker([coords[1], coords[0]], {
                        radius: Math.sqrt(props.population / 1000000) * 3,
                        fillColor: '#667eea',
                        color: '#fff',
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.7
                    });
                    
                    // Popup content
                    marker.bindPopup(`
                        <div class="popup-content">
                            <h3>${props.name}</h3>
                            <p><strong>Country:</strong> ${props.country}</p>
                            <p><strong>Population:</strong> ${props.population.toLocaleString()}</p>
                            <p><strong>Category:</strong> ${props.category}</p>
                        </div>
                    `);
                    
                    marker.addTo(citiesLayer);
                    
                    // Store for table
                    allData.push({
                        name: props.name,
                        country: props.country,
                        value: props.population,
                        type: 'City',
                        category: props.category,
                        marker: marker,
                        layer: 'cities'
                    });
                });
                
                updateTable();
            });

        // Load and display landmarks
        fetch('assets/world-landmarks.geojson')
            .then(response => response.json())
            .then(data => {
                landmarksData = data.features;
                
                data.features.forEach(feature => {
                    const coords = feature.geometry.coordinates;
                    const props = feature.properties;
                    
                    // Create custom marker
                    const marker = L.circleMarker([coords[1], coords[0]], {
                        radius: Math.sqrt(props.visitors / 100000) * 2,
                        fillColor: '#f093fb',
                        color: '#fff',
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.7
                    });
                    
                    // Popup content
                    const yearBuilt = props.year < 0 ? `${Math.abs(props.year)} BCE` : props.year;
                    marker.bindPopup(`
                        <div class="popup-content">
                            <h3>${props.name}</h3>
                            <p><strong>Country:</strong> ${props.country}</p>
                            <p><strong>Type:</strong> ${props.type}</p>
                            <p><strong>Year Built:</strong> ${yearBuilt}</p>
                            <p><strong>Annual Visitors:</strong> ${props.visitors.toLocaleString()}</p>
                        </div>
                    `);
                    
                    marker.addTo(landmarksLayer);
                    
                    // Store for table
                    allData.push({
                        name: props.name,
                        country: props.country,
                        value: props.visitors,
                        type: 'Landmark',
                        category: props.type,
                        marker: marker,
                        layer: 'landmarks'
                    });
                });
                
                updateTable();
            });

        // Layer toggle functionality
        document.getElementById('toggle-cities').addEventListener('click', function() {
            this.classList.toggle('active');
            if (this.classList.contains('active')) {
                citiesLayer.addTo(map);
            } else {
                map.removeLayer(citiesLayer);
            }
            updateTable();
        });

        document.getElementById('toggle-landmarks').addEventListener('click', function() {
            this.classList.toggle('active');
            if (this.classList.contains('active')) {
                landmarksLayer.addTo(map);
            } else {
                map.removeLayer(landmarksLayer);
            }
            updateTable();
        });

        // Search functionality
        document.getElementById('search-input').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            updateTable(searchTerm);
        });

        // Table sorting
        document.querySelectorAll('th.sortable').forEach(th => {
            th.addEventListener('click', function() {
                const column = this.dataset.column;
                
                if (currentSort.column === column) {
                    currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort.column = column;
                    currentSort.direction = 'asc';
                }
                
                // Update sort indicators
                document.querySelectorAll('th.sortable').forEach(header => {
                    header.classList.remove('sort-asc', 'sort-desc');
                });
                this.classList.add(`sort-${currentSort.direction}`);
                
                updateTable(document.getElementById('search-input').value);
            });
        });

        // Update table function
        function updateTable(searchTerm = '') {
            const citiesActive = document.getElementById('toggle-cities').classList.contains('active');
            const landmarksActive = document.getElementById('toggle-landmarks').classList.contains('active');
            
            // Filter data
            let filteredData = allData.filter(item => {
                const layerVisible = (item.layer === 'cities' && citiesActive) || 
                                    (item.layer === 'landmarks' && landmarksActive);
                const matchesSearch = item.name.toLowerCase().includes(searchTerm) || 
                                     item.country.toLowerCase().includes(searchTerm);
                return layerVisible && matchesSearch;
            });
            
            // Sort data
            if (currentSort.column) {
                filteredData.sort((a, b) => {
                    let aVal = a[currentSort.column];
                    let bVal = b[currentSort.column];
                    
                    if (typeof aVal === 'string') {
                        aVal = aVal.toLowerCase();
                        bVal = bVal.toLowerCase();
                    }
                    
                    if (currentSort.direction === 'asc') {
                        return aVal > bVal ? 1 : -1;
                    } else {
                        return aVal < bVal ? 1 : -1;
                    }
                });
            }
            
            // Update table body
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            
            filteredData.forEach(item => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.country}</td>
                    <td>${item.value.toLocaleString()}</td>
                    <td>${item.category}</td>
                `;
                
                // Click to zoom to marker
                row.addEventListener('click', () => {
                    map.setView(item.marker.getLatLng(), 10);
                    item.marker.openPopup();
                });
            });
            
            // Update stats
            const citiesCount = filteredData.filter(d => d.layer === 'cities').length;
            const landmarksCount = filteredData.filter(d => d.layer === 'landmarks').length;
            document.getElementById('stats-text').textContent = 
                `Showing ${filteredData.length} locations (${citiesCount} cities, ${landmarksCount} landmarks)`;
        }
    </script>
</body>
</html>
